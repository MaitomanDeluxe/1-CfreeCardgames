<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ポケカ開封シミュレーター</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #f0f8ff, #e6f7ff);
      overflow: hidden;
    }
    h1 {
      text-align: center;
      font-size: 2.8em;
      margin-top: 20px;
    }
    #pack-select {
      text-align: center;
      margin-top: 60px;
    }
    .pack-button {
      font-size: 24px;
      padding: 14px 36px;
      margin: 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      color: white;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .pack-button.red { background: crimson; }
    .pack-button.blue { background: dodgerblue; }
    #carousel-container {
      display: none;
      perspective: 1200px;
      width: 100%;
      height: 500px;
      position: relative;
      overflow: hidden;
      margin-top: 60px;
    }
    #carousel {
      position: absolute;
      top: 50%;
      left: 50%;
      transform-style: preserve-3d;
      transform: translate(-50%, -50%) rotateY(0deg);
      transition: transform 0.8s ease-out;
    }
    .carousel-item {
      position: absolute;
      width: 200px;
      height: 300px;
      transform-style: preserve-3d;
      transition: transform 0.5s ease;
      cursor: pointer;
    }
    .carousel-item img {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }
    .carousel-item.center {
      transform: scale(1.2) translateZ(80px) rotateY(0deg) !important;
      z-index: 10;
    }
    #card-area {
      display: none;
      position: relative;
      width: 100%;
      height: 500px;
      margin-top: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .card-stack {
      position: absolute;
      width: 260px;
      height: 360px;
      cursor: pointer;
      transition: top 0.5s ease, transform 0.8s;
    }
    .card-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>

<h1>ポケカ開封シミュレーター</h1>
<div id="pack-select">
  <h2>パックを選んでください</h2>
  <button class="pack-button red" onclick="startCarousel('r')">赤パック</button>
  <button class="pack-button blue" onclick="startCarousel('b')">青パック</button>
</div>

<div id="carousel-container">
  <div id="carousel"></div>
</div>

<div id="card-area"></div>

<script>
  const packSelect = document.getElementById('pack-select');
  const carouselContainer = document.getElementById('carousel-container');
  const carousel = document.getElementById('carousel');
  const cardArea = document.getElementById('card-area');

  let cardBack = 'r';
  let angle = 0;
  let index = 0;
  let numItems = 10;
  let rotating = false;

  function startCarousel(type) {
    cardBack = type;
    packSelect.style.display = 'none';
    carouselContainer.style.display = 'block';
    loadCarousel();
  }

  function loadCarousel() {
    carousel.innerHTML = '';
    for (let i = 0; i < numItems; i++) {
      const item = document.createElement('div');
      item.className = 'carousel-item';
      item.style.transform = `rotateY(${i * (360 / numItems)}deg) translateZ(400px)`;
      const img = document.createElement('img');
      img.src = `./images/card-back-${cardBack}.png`;
      item.appendChild(img);
      carousel.appendChild(item);
    }
    updateCenterItem();
  }

  function updateCenterItem() {
    const items = document.querySelectorAll('.carousel-item');
    items.forEach(i => i.classList.remove('center'));
    const current = items[index % numItems];
    current.classList.add('center');
  }

  function rotateCarousel(dir) {
    if (rotating) return;
    rotating = true;
    index = (index + dir + numItems) % numItems;
    angle -= dir * (360 / numItems);
    carousel.style.transform = `translate(-50%, -50%) rotateY(${angle}deg)`;
    setTimeout(() => {
      updateCenterItem();
      rotating = false;
    }, 800);
  }

  function openPack() {
    carouselContainer.style.display = 'none';
    cardArea.style.display = 'flex';
    const cards = getRandomCards(3);
    cardArea.innerHTML = '';
    cards.forEach((n, i) => {
      const div = document.createElement('div');
      div.className = 'card-stack';
      div.style.top = `${i * 10}px`;
      div.style.zIndex = 100 - i;
      const img = document.createElement('img');
      img.className = 'card-img';
      img.src = `./images/card-back-${cardBack}.png`;
      div.appendChild(img);
      let flipped = false;
      div.addEventListener('click', () => {
        if (!flipped && i === 0) {
          img.src = `./images/${n}.png`;
          flipped = true;
        } else if (flipped) {
          div.style.top = '120px';
          div.style.zIndex = 0;
          div.style.transform = 'scale(0.9)';
          setTimeout(() => {
            cardArea.removeChild(div);
            if (cardArea.children.length === 0) {
              cardArea.style.display = 'none';
              packSelect.style.display = 'block';
            }
          }, 800);
        }
      });
      cardArea.appendChild(div);
    });
  }

  function getRandomCards(n) {
    const pool = [1,2,3,4,5,6,7,8,9,10];
    const res = [];
    while (res.length < n) {
      const rand = pool[Math.floor(Math.random() * pool.length)];
      if (!res.includes(rand)) res.push(rand);
    }
    return res;
  }

  document.addEventListener('keydown', e => {
    if (carouselContainer.style.display !== 'block') return;
    if (e.key === 'ArrowRight') rotateCarousel(1);
    if (e.key === 'ArrowLeft') rotateCarousel(-1);
    if (e.key === 'Enter') openPack();
  });

  // スワイプ操作対応
  let startX = 0;
  carouselContainer.addEventListener('touchstart', e => {
    startX = e.touches[0].clientX;
  });
  carouselContainer.addEventListener('touchend', e => {
    const endX = e.changedTouches[0].clientX;
    const delta = endX - startX;
    if (delta > 50) rotateCarousel(-1);
    if (delta < -50) rotateCarousel(1);
  });
</script>

</body>
</html>
